-- ACL schema sql used in HSQLDB

-- drop table acl_entry;
-- drop table acl_object_identity;
-- drop table acl_class;
-- drop table acl_sid;


create table acl_sid(
    id bigint generated by default as identity(start with 100) not null primary key,
    principal boolean not null,
    sid varchar_ignorecase(100) not null,
    constraint unique_uk_1 unique(sid,principal));

create table acl_class(
    id bigint generated by default as identity(start with 100) not null primary key,
    class varchar_ignorecase(100) not null,
    constraint unique_uk_2 unique(class)
);

create table acl_object_identity(
    id bigint generated by default as identity(start with 100) not null primary key,
    object_id_class bigint not null,
    object_id_identity bigint not null,
    parent_object bigint,
    owner_sid bigint,
    entries_inheriting boolean not null,
    constraint unique_uk_3 unique(object_id_class,object_id_identity),
    constraint foreign_fk_1 foreign key(parent_object)references acl_object_identity(id),
    constraint foreign_fk_2 foreign key(object_id_class)references acl_class(id),
    constraint foreign_fk_3 foreign key(owner_sid)references acl_sid(id)
);

create table acl_entry(
    id bigint generated by default as identity(start with 100) not null primary key,
    acl_object_identity bigint not null,
    ace_order int not null,
    sid bigint not null,
    mask integer not null,
    granting boolean not null,
    audit_success boolean not null,
    audit_failure boolean not null,
    constraint unique_uk_4 unique(acl_object_identity,ace_order),
    constraint foreign_fk_4 foreign key(acl_object_identity) references acl_object_identity(id),
    constraint foreign_fk_5 foreign key(sid) references acl_sid(id)
);

create table AccountActivity (type integer, ACCOUNT_ACTIVITY_ID bigint not null, primary key (ACCOUNT_ACTIVITY_ID));
create table Activity (id bigint generated by default as identity (start with 1), creationDate timestamp not null, deletionDate timestamp, lastModified timestamp, resourceUnavailable bit, id_user bigint not null, primary key (id));
create table Authority (id bigint generated by default as identity (start with 1), authority varchar(255), primary key (id));
create table Authority_User (Authority_id bigint not null, users_id_user bigint not null);
create table Book (id_book bigint generated by default as identity (start with 1), creationDate timestamp not null, deletionDate timestamp, lastModified timestamp, slugTitle varchar(255), title varchar(255), owner_id_user bigint, primary key (id_book), unique (id_book), unique (slugTitle));
create table BookActivity (type integer, BOOK_ACTIVITY_ID bigint not null, id_book bigint not null, primary key (BOOK_ACTIVITY_ID));
create table BookAuthor (id_book bigint not null, id_user bigint not null);
create table Chapter (id bigint generated by default as identity (start with 1), creationDate timestamp not null, deletionDate timestamp, lastModified timestamp, slugTitle varchar(255), title varchar(255), id_book bigint not null, CHAPTER_POSITION integer, primary key (id));
create table ChapterActivity (type integer, CHAPTER_ACTIVITY_ID bigint not null, chapter_id bigint not null, primary key (CHAPTER_ACTIVITY_ID));
create table Comment (id bigint generated by default as identity (start with 1), creationDate timestamp not null, deletionDate timestamp, lastModified timestamp, content varchar(255), domId varchar(255) not null, state varchar(255) not null, title varchar(255), label_id bigint, publication_id bigint not null, user_id_user bigint, primary key (id));
create table CommentActivity (type integer, COMMENT_ACTIVITY_ID bigint not null, comment_id bigint not null, primary key (COMMENT_ACTIVITY_ID));
create table CommentLabel (id bigint generated by default as identity (start with 1), creationDate timestamp not null, deletionDate timestamp, lastModified timestamp, label varchar(255), primary key (id));
create table Publication (id bigint generated by default as identity (start with 1), creationDate timestamp not null, deletionDate timestamp, lastModified timestamp, content longvarchar, published bit not null, id_chapter bigint not null, primary key (id));
create table User (id_user bigint generated by default as identity (start with 1), creationDate timestamp not null, deletionDate timestamp, lastModified timestamp, email varchar(255) not null, fullname varchar(255) not null, password varchar(255), username varchar(255) not null, primary key (id_user), unique (username));
create table UserAuthority (User_id_user bigint not null, authorities_id bigint not null);
alter table AccountActivity add constraint FK906A1C3CF959FEDE foreign key (ACCOUNT_ACTIVITY_ID) references Activity;
alter table Activity add constraint FKA126572F35FE1083 foreign key (id_user) references User;
alter table Authority_User add constraint FKAE76EF877E9A3831 foreign key (Authority_id) references Authority;
alter table Authority_User add constraint FKAE76EF875AE9BD4C foreign key (users_id_user) references User;
alter table Book add constraint FK1FAF0922A946F7 foreign key (owner_id_user) references User;
alter table BookActivity add constraint FK108EED38C565759A foreign key (BOOK_ACTIVITY_ID) references Activity;
alter table BookActivity add constraint FK108EED3835ECAEBF foreign key (id_book) references Book;
alter table BookAuthor add constraint FKE10A91F435ECAEBF foreign key (id_book) references Book;
alter table BookAuthor add constraint FKE10A91F435FE1083 foreign key (id_user) references User;
alter table Chapter add constraint FK8F45142D35ECAEBF foreign key (id_book) references Book;
alter table ChapterActivity add constraint FK841EEE5C8418C0FE foreign key (CHAPTER_ACTIVITY_ID) references Activity;
alter table ChapterActivity add constraint FK841EEE5CBDE90DB1 foreign key (chapter_id) references Chapter;
alter table Comment add constraint FK9BDE863F177EE9D1 foreign key (publication_id) references Publication;
alter table Comment add constraint FK9BDE863F2821D64 foreign key (label_id) references CommentLabel;
alter table Comment add constraint FK9BDE863F90EDA80F foreign key (user_id_user) references User;
alter table CommentActivity add constraint FKCDF62E6E914DA810 foreign key (COMMENT_ACTIVITY_ID) references Activity;
alter table CommentActivity add constraint FKCDF62E6EFF23FC71 foreign key (comment_id) references Comment;
alter table Publication add constraint FK23254A0C92697C8D foreign key (id_chapter) references Chapter;
alter table UserAuthority add constraint FKFCA37F9890EDA80F foreign key (User_id_user) references User;
alter table UserAuthority add constraint FKFCA37F9817043793 foreign key (authorities_id) references Authority;

INSERT INTO PUBLIC.ACCOUNTACTIVITY(TYPE, ACCOUNT_ACTIVITY_ID) VALUES (0, 1);
INSERT INTO PUBLIC.ACCOUNTACTIVITY(TYPE, ACCOUNT_ACTIVITY_ID) VALUES (0, 2);
INSERT INTO PUBLIC.ACCOUNTACTIVITY(TYPE, ACCOUNT_ACTIVITY_ID) VALUES (0, 3);
INSERT INTO PUBLIC.ACTIVITY(ID, CREATIONDATE, DELETIONDATE, LASTMODIFIED, RESOURCEUNAVAILABLE, ID_USER) VALUES (1, '2010-03-25 23:05:53.298000000', null, null, false, 1);
INSERT INTO PUBLIC.ACTIVITY(ID, CREATIONDATE, DELETIONDATE, LASTMODIFIED, RESOURCEUNAVAILABLE, ID_USER) VALUES (2, '2010-03-25 23:05:53.467000000', null, null, false, 2);
INSERT INTO PUBLIC.ACTIVITY(ID, CREATIONDATE, DELETIONDATE, LASTMODIFIED, RESOURCEUNAVAILABLE, ID_USER) VALUES (3, '2010-03-25 23:05:53.471000000', null, null, false, 3);
INSERT INTO PUBLIC.ACTIVITY(ID, CREATIONDATE, DELETIONDATE, LASTMODIFIED, RESOURCEUNAVAILABLE, ID_USER) VALUES (4, '2010-03-25 23:05:53.494000000', null, null, false, 3);
INSERT INTO PUBLIC.ACTIVITY(ID, CREATIONDATE, DELETIONDATE, LASTMODIFIED, RESOURCEUNAVAILABLE, ID_USER) VALUES (5, '2010-03-25 23:05:54.015000000', null, null, false, 3);
INSERT INTO PUBLIC.ACTIVITY(ID, CREATIONDATE, DELETIONDATE, LASTMODIFIED, RESOURCEUNAVAILABLE, ID_USER) VALUES (6, '2010-03-25 23:05:54.027000000', null, null, false, 3);
INSERT INTO PUBLIC.ACTIVITY(ID, CREATIONDATE, DELETIONDATE, LASTMODIFIED, RESOURCEUNAVAILABLE, ID_USER) VALUES (7, '2010-03-25 23:05:54.072000000', null, null, false, 3);
INSERT INTO PUBLIC.ACTIVITY(ID, CREATIONDATE, DELETIONDATE, LASTMODIFIED, RESOURCEUNAVAILABLE, ID_USER) VALUES (8, '2010-03-25 23:05:54.148000000', null, null, false, 3);
INSERT INTO PUBLIC.ACTIVITY(ID, CREATIONDATE, DELETIONDATE, LASTMODIFIED, RESOURCEUNAVAILABLE, ID_USER) VALUES (9, '2010-03-25 23:05:54.153000000', null, null, false, 3);
INSERT INTO PUBLIC.ACTIVITY(ID, CREATIONDATE, DELETIONDATE, LASTMODIFIED, RESOURCEUNAVAILABLE, ID_USER) VALUES (10, '2010-03-25 23:05:54.195000000', null, null, false, 3);
INSERT INTO PUBLIC.ACTIVITY(ID, CREATIONDATE, DELETIONDATE, LASTMODIFIED, RESOURCEUNAVAILABLE, ID_USER) VALUES (11, '2010-03-25 23:05:54.205000000', null, null, false, 3);
INSERT INTO PUBLIC.ACTIVITY(ID, CREATIONDATE, DELETIONDATE, LASTMODIFIED, RESOURCEUNAVAILABLE, ID_USER) VALUES (12, '2010-03-25 23:05:54.235000000', null, null, false, 3);
INSERT INTO PUBLIC.ACTIVITY(ID, CREATIONDATE, DELETIONDATE, LASTMODIFIED, RESOURCEUNAVAILABLE, ID_USER) VALUES (13, '2010-03-25 23:05:54.261000000', null, null, false, 1);
INSERT INTO PUBLIC.AUTHORITY(ID, AUTHORITY) VALUES (1, 'ROLE_AUTHOR');
INSERT INTO PUBLIC.AUTHORITY(ID, AUTHORITY) VALUES (2, 'ROLE_ADMIN');
INSERT INTO PUBLIC.BOOK(ID_BOOK, CREATIONDATE, DELETIONDATE, LASTMODIFIED, SLUGTITLE, TITLE, OWNER_ID_USER) VALUES (1, '2010-03-25 23:05:53.494000000', null, '2010-03-25 23:05:53.494000000', 'the-book-of-wooki', 'The book of Wooki', 3);
INSERT INTO PUBLIC.BOOKACTIVITY(TYPE, BOOK_ACTIVITY_ID, ID_BOOK) VALUES (0, 4, 1);
INSERT INTO PUBLIC.BOOKAUTHOR(ID_BOOK, ID_USER) VALUES (1, 3);
INSERT INTO PUBLIC.BOOKAUTHOR(ID_BOOK, ID_USER) VALUES (1, 1);
INSERT INTO PUBLIC.BOOKAUTHOR(ID_BOOK, ID_USER) VALUES (1, 2);
INSERT INTO PUBLIC.CHAPTER(ID, CREATIONDATE, DELETIONDATE, LASTMODIFIED, SLUGTITLE, TITLE, ID_BOOK, CHAPTER_POSITION) VALUES (1, '2010-03-25 23:05:53.494000000', null, null, 'Abstract', 'Abstract', 1, 0);
INSERT INTO PUBLIC.CHAPTER(ID, CREATIONDATE, DELETIONDATE, LASTMODIFIED, SLUGTITLE, TITLE, ID_BOOK, CHAPTER_POSITION) VALUES (2, '2010-03-25 23:05:54.027000000', null, '2010-03-25 23:05:54.027000000', 'collaborative-document-publishing', 'Collaborative document publishing', 1, 1);
INSERT INTO PUBLIC.CHAPTER(ID, CREATIONDATE, DELETIONDATE, LASTMODIFIED, SLUGTITLE, TITLE, ID_BOOK, CHAPTER_POSITION) VALUES (3, '2010-03-25 23:05:54.153000000', null, '2010-03-25 23:05:54.153000000', 'open-source-contribution', 'Open source contribution', 1, 2);
INSERT INTO PUBLIC.CHAPTER(ID, CREATIONDATE, DELETIONDATE, LASTMODIFIED, SLUGTITLE, TITLE, ID_BOOK, CHAPTER_POSITION) VALUES (4, '2010-03-25 23:05:54.205000000', null, '2010-03-25 23:05:54.205000000', 'get-started', 'Get started', 1, 3);
INSERT INTO PUBLIC.CHAPTERACTIVITY(TYPE, CHAPTER_ACTIVITY_ID, CHAPTER_ID) VALUES (3, 5, 1);
INSERT INTO PUBLIC.CHAPTERACTIVITY(TYPE, CHAPTER_ACTIVITY_ID, CHAPTER_ID) VALUES (0, 6, 2);
INSERT INTO PUBLIC.CHAPTERACTIVITY(TYPE, CHAPTER_ACTIVITY_ID, CHAPTER_ID) VALUES (3, 7, 2);
INSERT INTO PUBLIC.CHAPTERACTIVITY(TYPE, CHAPTER_ACTIVITY_ID, CHAPTER_ID) VALUES (0, 9, 3);
INSERT INTO PUBLIC.CHAPTERACTIVITY(TYPE, CHAPTER_ACTIVITY_ID, CHAPTER_ID) VALUES (3, 10, 3);
INSERT INTO PUBLIC.CHAPTERACTIVITY(TYPE, CHAPTER_ACTIVITY_ID, CHAPTER_ID) VALUES (0, 11, 4);
INSERT INTO PUBLIC.CHAPTERACTIVITY(TYPE, CHAPTER_ACTIVITY_ID, CHAPTER_ID) VALUES (3, 12, 4);
INSERT INTO PUBLIC.COMMENT(ID, CREATIONDATE, DELETIONDATE, LASTMODIFIED, CONTENT, DOMID, STATE, TITLE, LABEL_ID, PUBLICATION_ID, USER_ID_USER) VALUES (1, '2010-03-25 23:05:54.122000000', null, null, 'This is a good starting point', 'b20', 'OPEN', null, null, 2, 3);
INSERT INTO PUBLIC.COMMENT(ID, CREATIONDATE, DELETIONDATE, LASTMODIFIED, CONTENT, DOMID, STATE, TITLE, LABEL_ID, PUBLICATION_ID, USER_ID_USER) VALUES (2, '2010-03-25 23:05:54.260000000', null, null, 'Wooki is really cool !', 'b10', 'OPEN', null, null, 1, 1);
INSERT INTO PUBLIC.COMMENTACTIVITY(TYPE, COMMENT_ACTIVITY_ID, COMMENT_ID) VALUES (1, 8, 1);
INSERT INTO PUBLIC.COMMENTACTIVITY(TYPE, COMMENT_ACTIVITY_ID, COMMENT_ID) VALUES (1, 13, 2);
INSERT INTO PUBLIC.PUBLICATION(ID, CREATIONDATE, DELETIONDATE, LASTMODIFIED, CONTENT, PUBLISHED, ID_CHAPTER) VALUES (1, '2010-03-25 23:05:53.767000000', null, '2010-03-25 23:05:54.015000000', '<p id="b10" class="commentable">What would you need if you had to write something and share it with someone else? We think you would be looking for Wooki : a<strong>publish platform</strong>offering the possibility to have<strong>direct feedback</strong>on what you have written.</p>', true, 1);
INSERT INTO PUBLIC.PUBLICATION(ID, CREATIONDATE, DELETIONDATE, LASTMODIFIED, CONTENT, PUBLISHED, ID_CHAPTER) VALUES (2, '2010-03-25 23:05:54.049000000', null, '2010-03-25 23:05:54.072000000', '<p id="b20" class="commentable">The desire to make Wooki came from a finding: we noticed that the documentation we wrote every days at work did not provide the expected result.</p><p id="b21" class="commentable">We used to produce lots of documents on multiples formats: Word, PDF, Powerpoint and of course on our intranet knowledge base.Each format used to have its inconvenient:</p><ul id="b22" class="commentable"><li>Intranet knowledge base wasn''t enough corporate</li><li>Word and PDF contents were not indexed by our intranet crawlers.</li></ul><p id="b23" class="commentable">And the worst was that we almost never had feedback on these documents. We did not knew if the produced documentation was good enough. Why?<strong>Because we did not proposed an easy way to collaborate with people</strong>.</p><p id="b24" class="commentable">Wooki''s goal is to suggest a solution to all theses problems. Of course, Wooki is not finished, that is just the beginning of the story.</p>', true, 2);
INSERT INTO PUBLIC.PUBLICATION(ID, CREATIONDATE, DELETIONDATE, LASTMODIFIED, CONTENT, PUBLISHED, ID_CHAPTER) VALUES (3, '2010-03-25 23:05:54.163000000', null, '2010-03-25 23:05:54.195000000', '<p id="b30" class="commentable">We are working since many months (...years?) on the web framework Tapestry 5. In some way, we always wanted to contribute to it as some kind of "<quote>thank you</quote>".</p><p id="b31" class="commentable">Doing a project like Wooki was perfect to show the possibilities of this framework: technologies integration, ease of development.</p>', true, 3);
INSERT INTO PUBLIC.PUBLICATION(ID, CREATIONDATE, DELETIONDATE, LASTMODIFIED, CONTENT, PUBLISHED, ID_CHAPTER) VALUES (4, '2010-03-25 23:05:54.225000000', null, '2010-03-25 23:05:54.235000000', '<h3 id="b40" class="commentable">Try the demo</h3><p id="b41" class="commentable">If you are reading that, you must already know that we host a demo website. You can freely:</p><ul id="b42" class="commentable"><li>create accounts</li><li>create books</li><li>export them as PDF</li></ul><h3 id="b43" class="commentable">Build Wooki directly from the source code</h3><p id="b44" class="commentable">Considering that you have already manipulated Tapestry 5 and maven, you can build the application directly from the source code.</p><p id="b45" class="commentable">Go on<a href="http://github.com/robink/wooki">Github</a>, download the sources and run jetty executing this command:</p><pre id="b46" class="commentable">mvn jetty:run</pre><p id="b47" class="commentable">Launch your browser and that''s it!</p>', true, 4);
INSERT INTO PUBLIC.PUBLICATION(ID, CREATIONDATE, DELETIONDATE, LASTMODIFIED, CONTENT, PUBLISHED, ID_CHAPTER) VALUES (5, '2010-03-25 23:05:54.247000000', null, '2010-03-25 23:05:54.248000000', '<p>What would you need if you had to write something and share it with someone else? We think you would be looking for Wooki : a <strong>publish platform</strong> offering the possibility to have <strong>direct feedback</strong> on what you have written.</p>', false, 1);
INSERT INTO PUBLIC.USER(ID_USER, CREATIONDATE, DELETIONDATE, LASTMODIFIED, EMAIL, FULLNAME, PASSWORD, USERNAME) VALUES (1, '2010-03-25 23:05:51.898000000', null, null, 'christophe@gmail.com', 'Christophe C.', 'f26c00488540ea41f52d2e216da55ecef8d063bb', 'ccordenier');
INSERT INTO PUBLIC.USER(ID_USER, CREATIONDATE, DELETIONDATE, LASTMODIFIED, EMAIL, FULLNAME, PASSWORD, USERNAME) VALUES (2, '2010-03-25 23:05:53.466000000', null, null, 'bruno@gmail.com', 'Bruno V.', 'f26c00488540ea41f52d2e216da55ecef8d063bb', 'bverachten');
INSERT INTO PUBLIC.USER(ID_USER, CREATIONDATE, DELETIONDATE, LASTMODIFIED, EMAIL, FULLNAME, PASSWORD, USERNAME) VALUES (3, '2010-03-25 23:05:53.470000000', null, null, 'robin@gmail.com', 'Robin K.', 'f26c00488540ea41f52d2e216da55ecef8d063bb', 'robink');
INSERT INTO PUBLIC.USER(ID_USER, CREATIONDATE, DELETIONDATE, LASTMODIFIED, EMAIL, FULLNAME, PASSWORD, USERNAME) VALUES (4, '2010-03-25 23:05:53.470000000', null, null, 'root@wooki.com', 'root', 'f26c00488540ea41f52d2e216da55ecef8d063bb', 'root');
INSERT INTO PUBLIC.USERAUTHORITY(USER_ID_USER, AUTHORITIES_ID) VALUES (1, 1);
INSERT INTO PUBLIC.USERAUTHORITY(USER_ID_USER, AUTHORITIES_ID) VALUES (2, 1);
INSERT INTO PUBLIC.USERAUTHORITY(USER_ID_USER, AUTHORITIES_ID) VALUES (3, 1);
INSERT INTO PUBLIC.USERAUTHORITY(USER_ID_USER, AUTHORITIES_ID) VALUES (4, 2);